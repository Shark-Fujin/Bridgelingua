# Bridgelingua P1-MVP 前端PRD

---

## 技术选型（已敲定）

| 层 | 选型 |
|---|------|
| 前端 | React(TS/JS) |
| 后端 | Python FastAPI + Pytorch |
| 数据库 | SQLite |
| ASR | OmniASR-LLM |
| 翻译 | NLLB-200 |
| 算力部署 | 单机GPU服务端POI |

---

## P1范围（严格界定）

**做**：
- **工作台**：音频上传/录音 → ASR转写(1600+语言) → NLLB翻译 → 校对编辑 → 多格式导出
- **语料库**：文件夹管理 + 元数据标注 + 搜索筛选 + 批量导出
- **词典**：双语词典CRUD + 词典快速录入模式（录音→ASR→存词条循环）+ 社区共享
- **设置**：后端连接配置 + 模型选择 + CARE默认值 + i18n多语言切换

**不做**：
- ❌ 用户注册登录（开放工具无账号）
- ❌ 实时流式ASR（只做batch）
- ❌ 微调pipeline
- ❌ TTS
- ❌ 离线模式（但需弱网提示）

---

## 页面结构

```
├── 🏠 工作台 (Workspace)     ← 用户80%时间，核心页
├── 📁 语料库 (Library)        ← 文件管理+归档
├── 📖 词典 (Lexicon)          ← 双语词典构建
└── ⚙️ 设置 (Settings)        ← 后端配置+偏好
```

---

## 功能清单 + 优先级

*P0 = MVP必须有，P1 = 首版后快速补，P2 = 有空再做*

### 工作台 (Workspace)

| ID | 功能 | P | 说明 |
|----|------|---|------|
| W-01 | 源语言选择器 | 0 | 1600 Omni支持的语言，搜索+按地区分组 |
| W-02 | 目标语言选择器 | 0 | NLLB的200语言，注意和W-01列表不同 |
| W-03 | 音频上传 | 0 | wav/mp3/flac/ogg/m4a，拖拽或点击，显示文件名+时长 |
| W-04 | 浏览器录音 | 0 | WebAudio API，实时波形，录/停/回放 |
| W-05 | 转写按钮+进度 | 0 | 进度条+预估时间 |
| W-06 | 分段转写结果 | 0 | 时间戳(起-止) + 文本，每段可编辑 |
| W-07 | 双栏翻译对照 | 0 | 左原文右译文，段落对应，滚动联动 |
| W-08 | 逐段编辑+重译 | 0 | 点击框选即编辑，改后出现"重新翻译此段"按钮 |
| W-09 | 音频播放器 | 0 | 播放/暂停/进度/倍速/点文本段跳转对应音频位置 |
| W-10 | 导出 | 0 | JSON / CSV / SRT / ELAN XML，弹窗选格式 |
| W-11 | 存入语料库 | 0 | 弹窗填元数据(说话人/地点/日期/许可证) → 保存 |
| W-12 | ASR/翻译模型选择 | 0 | 下拉默认OmniASR+NLLB，预留其他模型槽位(置灰coming soon) |
| W-13 | 自动压缩长传语音 | 1 | 支持超过1GB的长文件 |
| W-14 | 自动草稿保存与恢复 | 1 | 防止浏览器关闭/刷新导致校对内容丢失,工作台编辑内容自动保存，重新打开可恢复 |
| W-15 | 语言互换 | 1 | 一键交换源/目标语言 |
| W-16 | 存入词典 | 1 | 选中文本段 → 添加为词条 |
| W-17 | 分段置信度可视化 | 1 | 快速定位低质量段落，减少通读成本 | 每段显示 confidence，低置信度段高亮提示“优先复核” |
| W-18 | 自动语言检测 | 2 | 上传后LID自动识别语言 |


### 语音语料库 (Library)

| ID | 功能 | P |
|----|------|---|
| L-01 | 文件夹树（可自建多层-推荐按照 {语言[项目]}的逻辑，右键菜单） | 0 |
| L-02 | 文件列表表格（名称/语言/时长/日期/标签，可排序） | 0 |
| L-03 | 搜索（文件名+转写内容，模糊匹配） | 0 |
| L-04 | 导出（单文件/批量） | 0 |
| L-05 | 文件详情面板（元数据+播放器+转写预览） | 1 |
| L-06 | 元数据编辑 | 1 |
| L-07 | 筛选（语言/日期/标签/许可证） | 1 |
| L-08 | 标签管理 | 1 |
| L-09 | 批量操作（移动/打标签/删除） | 2 |
| L-10 | 提取到词典 | 2 |

### 词典 (Lexicon)

| ID | 功能 | P |
|----|------|---|
| X-01 | 词典管理（创建/重命名/删除，每个绑定一对语言） | 0 |
| X-02 | 词条列表 + 搜索 | 0 |
| X-03 | 词条详情（词形/IPA/释义/词性/音频/例句） | 0 |
| X-04 | 导出（CSV/JSON） | 0 |
| X-05 | 新建/编辑词条 | 0 |
| X-06 | 快速录入模式（见下方详细说明） | 1 |
| X-07 | 从转写提取词条 | 1 |
| X-08 | 导入（CSV/LIFT XML） | 1 |
| X-09 | 社区共享（重点功能）:个人公开分享功能 | 1 |
| X-10 | 社区共享（重点功能）:共享词典功能+查找搜索/贡献（类似有道词典的个人贡献） | 1 |

### 设置 (Settings)

| ID | 功能 | P |
|----|------|---|
| S-01 | 后端接入方式+GPU端点配置 | 0 |
| S-02 | 连接测试按钮（成功✓/失败✗+错误） | 0 |
| S-03 | 默认ASR/翻译模型选择 | 0 |
| S-04 | CARE默认许可证类型 | 0 |
| S-05 | 界面语言（中/英/...至少支持5国语言） | 0 |
| S-06 | 主题（Light/Dark/Auto） | 1 |
| S-07 | 默认源/目标语言 | 1 |
| S-08 | 高级模型参数（beam size等，折叠隐藏） | 2 |

---

## 关键交互说明

### 语言选择器
- focus → 展开面板，顶部搜索框，下方按Region分tab（All/Africa/Americas/Asia/Europe/Pacific）
- 每种语言显示：英文名 + 本地名 + ISO 639-3 + 状态标签（">1M" / "<10K" / "Endangered"）
- **ASR语言(1600+)和翻译语言(200)是两份不同列表**

### 转写流程
- 点"转写"→ 按钮变进度态 → 完成后自动触发翻译（可在设置关闭）
- 编辑转写文本后，该段旁出现"🔄 重新翻译此段"

### 录音流程（常规录音逻辑）
- 点录音 → 请求麦克风权限 → 录音中(按钮红+计时+实时波形) → 停止 → 保存草稿/重录

### 快速录入模式（词典核心功能）

```
新建项目进入词典快速录入模式后：
循环：长按录音（Space） → 说词 → 松手停止 → ASR自动填入"词形"字段
     → 跳到翻译（Tab） → 输入释义 → 选词性 → Enter保存 → 自动下一条
```

快捷键：`Space`录音开关 / `Tab`切字段 / `Enter`保存下一条 / `Esc`退出

界面：顶部进度(12/50)，中间录音区+表单字段，底部最近录入列表

### 错误/边界状态
- 后端未配置 → 顶部黄色提示条"⚠ 请先配置后端GPU连接 [前往设置]"
- 转写失败 → 结果区显示错误信息 + 重试按钮
- 语言对不支持翻译 → 译文栏显示"该语言对暂不支持翻译"
- 音频 >100MB → 前端拦截
- 弱网/超时 → "连接中..." / 超时显示"重试"

---

## API端点参考（后端按需调整）

```
# 核心推理
POST   /api/transcribe              音频+lang → 分段转写{segments:[{start,end,text}]}
POST   /api/translate               文本段+语言对 → 翻译

# 语料库
GET/POST     /api/library/folders
GET          /api/library/files      ?folder_id=&search=&language=&tag=
POST         /api/library/files      保存(音频+转写+元数据)
GET/PUT/DEL  /api/library/files/:id
POST         /api/library/files/export

# 词典
GET/POST     /api/lexicons
GET/PUT/DEL  /api/lexicons/:id
GET/POST     /api/lexicons/:id/entries
GET/PUT/DEL  /api/lexicons/:id/entries/:eid
POST         /api/lexicons/:id/export
POST         /api/lexicons/:id/import

# 设置 + 语言
GET/PUT      /api/settings
POST         /api/settings/test-connection
GET          /api/languages          全量1600+语言(含region/endangerment)
GET          /api/languages/asr      ASR支持子集
GET          /api/languages/translation  翻译支持子集
```

---

## CARE数据治理（UI要求）

- 上传/录音时必选许可证（CC-BY / CC-BY-SA / CC-BY-NC / Restricted / Community-Only）
- 可标记音频段为"sacred/仪式"限制分享
- 元数据含社区/组织归属字段
- 首次使用弹出数据主权提示
- 用户可随时删除全部数据

---

## 核心用户流

### Flow A：首次使用 → 配置后端 → 转写第一段音频

```
1. 打开Bridgelingua → 进入工作台
2. 顶部提示"⚠ 请先配置后端连接 [前往设置]"
3. 前往Settings → 选接入方式 → 填GPU端点URL → 测试连接 ✓
4. 返回工作台 → 选源语言(搜索"Iu Mien") → 选目标语言(English)
5. 上传wav文件 → 点"开始转写" → 等待进度条
6. 查看分段转写 + 自动翻译 → 双击某段校对 → 点"重新翻译此段"
7. 点"导出" → 选SRT → 下载
```

### Flow B：田野录音 → 转写 → 存入语料库

```
1. 工作台 → 点"录音" → 允许麦克风 → 录音中(波形+计时)
2. 停止 → 回放确认 → 确认使用
3. 选语言 → 转写 → 翻译完成
4. 点"存入语料库" → 弹窗填：说话人/地点/日期/许可证/标签
5. 选目标文件夹(或新建) → 保存
```

### Flow C：快速录入模式批量构建词典

```
1. 词典页 → 新建词典(Iu Mien → English) → 点"🎤 快速录入"
2. Space录音 → 说"mbuo" → Space停止
3. ASR自动转写填入词形"mbuo" → 确认
4. Tab → 输入"water" → Tab → 选"noun" → Enter保存
5. 自动清空准备下一条 → 重复步骤2-4循环
6. 50条后退出 → 点"导出" → CSV下载
```

### Flow D：语料库管理

```
1. 语料库页 → 新建文件夹结构(项目/子类别)
2. 拖拽文件到文件夹 → 搜索转写内容 → 筛选语言/标签
3. 批量选择 → 导出ELAN XML → 下载zip
```

---

## 非功能性

- **响应式**：Desktop(1200+) / Tablet(768+) / Mobile(375+)，手机能跑完核心流程
- **i18n**：至少实现中英在内的五种主流语言internationalization支持，文案存独立文件
- **可访问性**：键盘可导航，基本WCAG AA

---

## 验收标准

1. 全部P0功能可用
2. 能转写至少5种不同语系语言且结果基本可读
3. 转写+翻译端到端 < 60s（30s音频）
4. 4种导出格式正常（SRT能被播放器读，ELAN XML能被ELAN打开）
5. 词典快速录入模式完整循环跑通
6. 语料库CRUD + 搜索正常
7. 中英切换 + 暗色模式可用
8. 手机浏览器可完成：上传/录音→转写→导出